{% set rdma_subnet = hostvars[inventory_hostname]['rdma_network'] + '/' + hostvars[inventory_hostname]['rdma_netmask'] %}
{% set rdma_subnet_prefix = rdma_subnet | ansible.netcommon.ipaddr('prefix') %}
{% set rdma_subnet_cidr = rdma_subnet | ansible.netcommon.ipaddr('network/prefix') %}
{% set host_index = hostvars[inventory_hostname]['ansible_default_ipv4']['address'] | ansible.netcommon.ipsubnet(hostvars[inventory_hostname]['private_subnet'])  %}
{% set rdma_address = rdma_subnet_cidr | ansible.netcommon.ipsubnet(rdma_subnet_prefix, index) | ansible.netcommon.ipmath(host_index | int -1) %}

TYPE="Ethernet"
BOOTPROTO="none"
IPADDR={{ rdma_address }}
NETMASK={{ hostvars[inventory_hostname]['rdma_netmask'] }}
DEFROUTE="no"
PEERDNS="no"
PEERROUTES="no"
IPV4_FAILURE_FATAL="no"
IPV6INIT="no"
IPV6_FAILURE_FATAL="no"
NAME="System {{ item['device'] }}"
UUID="{{ hostvars[inventory_hostname]['ansible_fqdn'] | to_uuid }}"
DEVICE="{{ item['device'] }}"
ONBOOT="yes"
